buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "org.jfrog.buildinfo:build-info-extractor-gradle:latest.release"
    }
}

plugins {
    id 'java'
    id 'org.springframework.boot' version '3.0.1'
    id 'io.spring.dependency-management' version '1.1.0'
//    id 'maven-publish'
//    id 'maven'
}
apply plugin: 'com.jfrog.artifactory'
apply plugin: 'maven-publish'

group = 'com.lisz.circleci-jfrog-test'
version = '1.0'
sourceCompatibility = '8'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

tasks.named('test') {
    useJUnitPlatform()
}

task sourcesJar(type: Jar) {
    from sourceSets.main.allJava
    archiveClassifier = 'sources'
}

task javadocJar(type: Jar) {
    from javadoc
    archiveClassifier = 'javadoc'
}

artifactory {
//    contextUrl = 'http://jfrog:8082/artifactory/'
    contextUrl = 'https://lisz1012.jfrog.io/artifactory/default-gradle-release-local/'
    publish {
        repository {
            repoKey = 'circleci-jfrog-test-1.0' // The Artifactory repository key to publish to
            username = "admin" // The publisher user name
            password = "Nev2661170," // The publisher password
        }
        defaults {
            // Reference to Gradle publications defined in the build script.
            // This is how we tell the Artifactory Plugin which artifacts should be
            // published to Artifactory.
            publications('mavenJava')
            publishArtifacts = true
            // Properties to be attached to the published artifacts.
            properties = ['qa.level': 'basic', 'dev.team' : 'core']
            // Publish generated POM files to Artifactory (true by default)
            publishPom = true
            // "Item circleci-jfrog-test-1.0:webapp/builds/circleci-jfrog-test/1674198625201 does not exist"
        }
    }
}

publishing {
    publications {
        maven(MavenPublication) {
            from components.java
            artifact bootJar
            // 生成源码包
            //artifact sourcesJar
            // 生成javadoc包
            //artifact javadocJar
//            groupId = 'com.lisz.circleci-jfrog-test'
//            artifactId = 'circleci-jfrog-test'
//            version = '1.0'
            artifact("build/libs/circleci-jfrog-test-1.0.jar")
        }
    }
}


//apply plugin: 'maven-publish'
//apply plugin: 'maven'

//def MAVEN_LOCAL_PATH ='http://jfrog:8082/artifactory/circleci-jfrog-test-1.0/'
//def ARTIFACT_ID = 'circleci-jfrog-test'
//def VERSION_NAME = '1.0'
//def GROUP_ID = 'com.lisz.circleci-jfrog-test'
//
//uploadArchives {
//    repositories {
//        mavenDeployer {
//            repository(url:MAVEN_LOCAL_PATH ){
//                authentication(userName: "admin", password:"Nev2661170,")
//            }
//            pom.project {
//                groupId GROUP_ID
//                artifactId ARTIFACT_ID
//                version VERSION_NAME
//                packaging 'aar'
//            }
//        }
//    }
//}


//allprojects {
//    repositories {
//        maven {
//            url "http://jfrog:8082/artifactory/circleci-jfrog-test-1.0/"
//            allowInsecureProtocol = true
//        }
//    }
//}